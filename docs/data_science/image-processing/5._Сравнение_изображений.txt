Сравнение изображений:
глобальные признаки
Высшая школа цифровой культуры
Университет ИТМО
dc@itmo.ru
Содержание
1 Свойства изображений и их сравнение: традиционный подход
к компьютерному зрению 2
1.1 Зачем сравнивать изображения? . . . . . . . . . . . . . . . . . . 2
1.2 Как сравнивать изображения? . . . . . . . . . . . . . . . . . . . 4
1.2.1 Глубокое обучение vs. традиционное компьютерное зрение 5
1.3 Признаки изображений . . . . . . . . . . . . . . . . . . . . . . . 6
1.4 Признаки по содержанию: цвет, текстура, форма . . . . . . . . . 7
1.5 Цвет . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
1.5.1 Использование гистограмм . . . . . . . . . . . . . . . . . 7
1.5.2 Часто используемые функции для сравнения гистограмм 8
1.6 Сравнение цветов . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
1.6.1 Гистограммы . . . . . . . . . . . . . . . . . . . . . . . . . 10
1.7 Текстуры . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14
1.7.1 Фильтры Габора . . . . . . . . . . . . . . . . . . . . . . . 15
1.7.2 Фильры ICA . . . . . . . . . . . . . . . . . . . . . . . . . 16
Высшая школа цифровой культуры Университет ИТМО
1 Свойства изображений и их сравнение:
традиционный подход к компьютерному зрению
1.1 Зачем сравнивать изображения?
В предыдущих лекциях мы обсуждали низкоуровневые методы обработ-
ки изображений, которые могут быть очень полезны для улучшения изоб-
ражений. В таких случаях как на входе, так на выходе были изображения,
но изображения, которые мы получали на выходе, были в некотором смысле
лучше, чем на входе: менее зашумленными или с более высокой контрастно-
стью. Рассмотренные нами методы упрощают анализ изображений и извле-
чение семантической информации как для человека, так и для компьютера.
Они являются основой для других более сложных алгоритмов анализа изоб-
ражений и распознавания изображений, которые мы обсудим далее.
Во вводной части курса мы рассмотрели различные задачи и обла-
сти применения анализа и распознавания изображений: поиск изображений,
классификация, сегментация, обнаружение и распознавание объектов и мно-
гие другие. Многие из эих задач основаны на понятии сходства изображений.
Определение сходства может меняться от задачи к задаче, но умение сравни-
вать два изображения для решения конкретной задачи имеет первостепенное
значение во всех областях применения.
Поиск изображений Для решения задачи поиска изображений мы счита-
ем два изображения похожими, если они имеют как визуальное, так и семан-
тическое сходство. Но это не обязательно должны быть изображения одина-
ковых объектов. Посмотрим на два изображения, представленные на экране:
они похожи, поскольку на них изображены сельские горные районы в летнее
время. В таком случае мы обращаем внимание на схожесть изображений в
целом.
Классификация сцен Для задачи классификации сцен семантическое
сходство играет более важную роль, чем визуальное сходство. Если мы хотим
классифицировать сцены с точки зрения места места, где они происходят -
в помещении или на улице, то можно ожидать, что все изображения на этом
слайде будут рассматриваться как похожие, потому что на всех этих изобра-
жениях представлены сцены на открытом воздухе. Также, нам бы хотелось,
чтобы зимний пейзаж с большим количеством белого снега имел большую
степень сходства с зеленым травянистым летним пейзажем, чем с чистой бе-
лой комнатой.
2
Высшая школа цифровой культуры Университет ИТМО
Определение объектов и сегментацияНо если наша задача - обнару-
жение объектов, и нас интересуют автобусы, трамваи и автомобили, то изоб-
ражения, рассмотренные на предыдущем слайде, попадут в разные классы.
Мы ожидаем, что верхнее и нижнее изображения во втором столбце будут
считатьсяпохожими,такжекакидваизображениявтретьемстолбце,потому
что на этих парах изображений представлены объекты одного типа. В задаче
обнаружения объектов мы обычно ищем сходство между фрагментами изоб-
ражения, отображающими интересующие нас объекты, а фон не принимаем
во внимание.
Задача семантической сегментации аналогична задаче обнаружения объ-
екта, но требует гораздо более точной локализации объекта. Вместо пример-
ного местоположения объекта цель сегментации изображения - предоставить
метки для каждого пикселя - независимо от того, принадлежит он объекту
или нет. Для этого нам может понадобиться измерить сходство не только
между любым заданным фрагментом анализируемого изображения и неко-
торым золотым шаблоном интересующего нас объекта, но также между раз-
личными фрагментами анализируемого изображения - чтобы понять, при-
надлежат два соседних фрагмента к тому же объекту или же нет.
Аннотация изображений Для аннотации изображений нужно выбрать
теги как для объектов, так и для фона в изображениях. Например, на мно-
гих изображениях есть небо, на некоторых - дорога. И в таком случае нужно
будет сравнить фрагменты изображений с некоторыми представлениями кон-
кретных тегов. Эта задача решается путем многоклассовой классификации -
каждое изображение может иметь несколько меток, и мы сравниваем каждое
изображение, которое нам дано, с представлениями каждой метки в словаре
имеющихся меток.
Поиск неполных дубликатов, выравнивание изображений, трех-
мерная реконструкция, отслеживание движенияВо всех задачах, о
которых мы говорили до сих пор, два изображения могут считаться похожи-
ми, даже если на них представлена не одна и та же сцена или не одинаковые
объекты. Если наша задача состоит в обнаружении трамвая, то представлен-
ные на экране изображения трамваев будут принадлежать к одному классу
и должны считаться похожими. Но для некоторых других задач, таких как
поиск неполных дубликатов, выравнивание изображений, 3D-реконструкция,
отслеживание движения, нам необходимо иметь возможность определять, од-
на и та же сцена (один и тот же объект) представлена ли на двух изобра-
жениях или нет. В задачах такого рода изображения зеленых трамваев не
следует считать одинаковыми, тогда как два изображения желтого пикапа и
два снимка местности должны считаться одинаковыми. Нам также необхо-
3
Высшая школа цифровой культуры Университет ИТМО
димо научиться определять позиции совпадающих точек для решения задач
такого рода.
1.2 Как сравнивать изображения?
Теперь, когда мы уже поняли, что нам нужно сравнивать сходство изоб-
ражений, возникает следующий вопрос: как это сделать? Компьютеру необхо-
димо числовое представление изображений и метрика подобия, определенная
в некотором пространстве представления. Числовое представление изображе-
нияобычноназываютвекторомпризнаков.Самыйпростойвекторпризнаков,
который вы можете использовать, - это непосредственно интенсивности необ-
работанных пикселей. Можно сравнивать изображения попиксельно, исполь-
зуя базовые векторы признаков, но такой метод хорошо работает только для
определенияточныхкопийизображений.Метрикипопиксельногосходстване
способны уловить семантическое сходство между изображениями. Даже два
изображения одной и той же сцены из одного и того же положения дадут нам
разные значения пикселей из-за потенциальных различий в условиях освеще-
ния, экспозиции или фокусировки. Вот почему представление изображения
в виде необработанного набора значений интенсивности пикселей обычно яв-
ляется лишь отправной точкой для построения более сложных признаков,
которые затем используются для сравнения изображений.
Результатом выделения признаков является вектор признаков. Вектор
признаков - это просто вектор, который содержит информацию, описываю-
щую важные характеристики изображения. Векторы признаков обычно яв-
ляются более компактным представлением изображения, чем исходные зна-
чения пикселей, но в то же время они более точно описывают изображение
и сохраняют ключевую семантическую информацию, представляющую инте-
рес.
Когда мы получаем новое представление изображений в виде векторов
признаков,мыможемсравниватьэтивекторы,используямерысходства,под-
ходящие для решения конкретных задач и определенные в соответствующих
пространствах признаков.
Пространства признаков Итак, вектор признаков - это абстракция изоб-
ражения, используемая для описания и количественной оценки содержимого
изображения. Векторы обычно состоят из вещественных, целых или двоич-
ных значений. Проще говоря, вектор признаков - это список чисел, исполь-
зуемых для представления изображения. При обработке изображений могут
использоваться различные признаки. Традиционные алгоритмы обработки
изображений и компьютерного зрения часто полагаются на очень сложные
наборы признаков. И выбор признаков для конкретной системы и задачи
компьютерного зрения может сильно зависеть от конкретной проблемы.
4
Высшая школа цифровой культуры Университет ИТМО
Выбор информативных и независимых отличительных признаков явля-
ется важным шагом для создания эффективных алгоритмов распознавания,
классификации и регрессии. Обычно используются числовые функции, ино-
гда также используются структурные элементы, такие как строки и графики.
Векторное пространство, связанное с векторами признаков и функцией
подобия, определенной для этого пространства, часто называется простран-
ством признаков. Другими словами, пространство признаков - это просто
пространство всех возможных векторов признаков с заданной функцией, ко-
торуюможноиспользоватьдлявычислениясходства(илирасстояния)между
любыми заданными двумя векторами признаков.
В некоторых задачах недостаточно выделить только один тип призна-
ков для получения соответствующей информации из изображения. В таких
случаях извлекаются два или более различных вектора признаков. И каждое
из этих пространств признаков может иметь собственную связанную с ним
меру сходства.
Векторы признаков могут быть объединены в один длинный объединен-
ный вектор признаков, а затем мы можем определить функцию подобия для
этого нового пространства признаков более высокой размерности.
Комбинирование векторов признаков Существует простой способ
определить функцию подобия для комбинации различных векторов призна-
ков - использовать линейную комбинацию функций подобия, определенных
для каждого из исходных пространств признаков. Если у нас есть функция
подобия 𝑑1, определенная для признаков𝑋, функция подобия𝑑2 определен-
ная для признаков𝑌 и т. д., мы можем определить функцию подобия для
объединенного пространства признаков как взвешенную сумму всех𝑑𝑖. Та-
ким образом, при измерении сходства между двумя изображениями мы бу-
дем учитывать различные признаки, а также можем определить важность
каждого признака для решения конкретной задачи, что позволит нам соот-
ветствующим образом скорректировать веса во взвешенной сумме.
1.2.1 Глубокое обучение vs. традиционное компьютерное зрение
Алгоритм извлечения признаков может быть разработан и запрограм-
мирован вручную. Этот этап также называется построением признаков. По-
строение признаков - сочетание искусства и науки, на этом шаге требует-
ся множество экспериментов, которые основываются на интуиции и знаниях
специалиста в предметной области. Основные достижения в области тради-
ционного компьютерного зрения связаны с применением все более сложных
методов извлечения признаков. За последние несколько лет во многих сферах
применения традиционных методов компьютерного зрения на смену ручному
5
Высшая школа цифровой культуры Университет ИТМО
построению признаков пришли автоматические методы обучения признаков.
Глубокое обучение позволило компьютеру не только использовать для обу-
чения признаки, выделенные вручную, но обучиться на других признаках.
Глубокое обучение включает в себя как трудоемкое построение признаков,
так и автоматизированное принятие решений. Сегодня во многих задачах
можно подавать необработанные значения пикселей в алгоритм машинного
обучения и получать более точные прогнозы, чем когда-либо прежде. Мы по-
говорим о глубоком обучении в области компьютерного зрения в следующих
лекциях. Сейчас мы остановимся на традиционных алгоритмах. Несмотря на
то, что в настоящий момент глубокое обучение является наиболее распро-
страненным решением для некоторых задач распознавания изображений, в
других задачах, таких как выравнивание изображений и 3D-реконструкция,
исследователи по-прежнему часто полагаются на традиционные методы по-
строения признаков, а именно, на признаки, выделенные вручную.
1.3 Признаки изображений
Текстовые и визуальные признакиТеперь давайте посмотрим на раз-
личные виды признаков изображений. Есть разные способы их категориза-
ции. Во-первых, признаки изображений можно разделить на текстовые и ви-
зуальные. Текстовые признаки состоят из текстовых аннотаций, созданных
пользователем,иметаданныхизображений,такихкакгеотеги,датасоздания,
настройки камеры и т.д. Они не связаны с пикселями изображения, но тем не
менее могут быть очень полезны для различных задач и часто используются
в сочетании с визуальными признаками.
Визуальные признаки - это признаки, полученные из необработанных
значений пикселей. Такие признаки базируются на содержании. Они могут
характеризовать распределение цвета в изображении, текстуру изображения,
форму объектов, взаимное расположение объектов, шаблоны цвета или тек-
стуры.
Глобальные и локальные Визуальные признаки можно разделить на
глобальные и локальные. Глобальные признаки описывают изображение в
целом. Обычно глобальные признаки вычисляются на основе значений всех
пикселей изображения, например, цветовая гистограмма изображения или
средняя интенсивность изображения. Такие признаки могут использоваться
для задач поиска изображений и классификации сцен, но в настоящее время
они в основном заменены глубоким обучением.
Локальные признаки описывают фрагмент изображения. Многие ло-
кальные признаки вычисляются для областей, расположенных поблизости
от так называемых ключевых точек или точек, представляющих интерес.
Поиск ключевых точек и локальные признаки по-прежнему широко исполь-
6
Высшая школа цифровой культуры Университет ИТМО
зуются для решения многих задач, таких как выравнивание изображений,
3D-реконструкция, отслеживание движения. Всего несколько лет назад по-
добные построенные вручную локальные признаки успешно использовались
также в обнаружении и сегментации объектов, но в настоящее время для
решения этих задач машинное и глубокое обучение заменили ручное постро-
ение признаков. Мы перейдем к глубокому обучению немного позже, а теперь
давайте поговорим в целом о признаках, основанных на содержании, а также
изучим пару наиболее известных методов выделения локальных признаков,
которые все еще используются в настоящее время в ряде задач компьютер-
ного зрения.
1.4 Признаки по содержанию: цвет, текстура,
форма
Существует множество различных классификаций признаков по содер-
жанию. Цвет, текстура и форма - одни из самых интуитивно понятных для
человека свойств изображения. В компьютерном зрении существует множе-
ство подходов к описанию и представлению этих важных свойств. Векторы
признаков иногда также называют дескрипторами. Дескрипторы цвета, тек-
стуры и формы описывают цвет, текстуру и форму всего изображения или
какой-либо части изображения. Информация о пространственном расположе-
ниичастейизображениятакжебываетважнойдлярешениянекоторыхзадач,
в таком случае помимо информации о цвете, текстуре и форме изображе-
ния могут использоваться в том числе и пространственные характеристики,
предоставляющие информацию о пространственном расположении фрагмен-
тов изображения.
1.5 Цвет
1.5.1 Использование гистограмм
Цвет, несомненно, является наиболее важным признаком визуального
восприятия изображения человеком. Именно поэтому важную роль в анализе
изображений играют цветовые дескрипторы. Естественный способ сравнить
цветовые характеристики двух изображений - это сравнить распределение
цветов на этих изображениях. Таким образом, многие характеристики цвета
являются дескрипторами распределения вероятностей; а функции расстоя-
ния для распределений вероятности, являются общепринятыми метриками,
используемыми для сравнения характеристик цвета.
Наиболее очевидно представить распределение цвета в виде гистограм-
мы. Гистограммы часто используются в качестве признаков изображения.
Цветовая гистограмма - это представление распределения цветов в изобра-
жении. Она получается путем подсчета и нормировании количества пиксе-
7
Высшая школа цифровой культуры Университет ИТМО
лей в изображении, которые попадают в каждый из возможных цветов в
данном цветовом пространстве. Таким образом, когда цветовые гистограм-
мы используются в качестве цветовых признаков, изображения будут пред-
ставлены векторами длины, равной общему количеству цветов в выбранном
цветовом пространстве, где каждый элемент вектора признаков представляет
собой долю пикселей определенного цвета в данном изображении. Затем два
изображения можно легко сравнить, вычислив расстояние между гистограм-
мами цвета, которые их описывают. Для этого могут использоваться различ-
ные метрики, перечислим несколько из них:𝐿1 или просто сумма поэлемент-
ных разностей двух векторов,𝐿2 - евклидова метрика,𝐿∞, расстояние хи-
квадрат, расстояние Вассерштейна (в англоязычной литературе можно часто
встретить название название этой функции Earth Mover Distance или EMD).
Поскольку мы говорим о распределениях, стандартные статистические
метрики также иногда используются для более компактного представления
цветовых распределений изображения, а именно три первые момента: сред-
нее значение, дисперсия и асимметрия. Стандартные метрики могут также
использоваться для измерения расстояния между векторами признаков.
1.5.2 Часто используемые функции для сравнения гистограмм
Мы упомянули множество различных функций, которые можно исполь-
зовать для сравнения двух гистограмм. На практике чаще всего использу-
ются пересечение гистограмм и хи-квадрат. Чтобы сравнить гистограммы
цветов двух изображений разного размера, важно сначала нормировать ги-
стограммы.
Пересечение гистограмм - это самый простой и быстрый способ вычис-
ления метрики расстояний. Оно определяется как
ℎ𝑖𝑠𝑡𝑖𝑛𝑡(𝐻1, 𝐻2) = 1−
𝐾∑︁
𝑖=1
𝑚𝑖𝑛(𝐻1(𝑖), 𝐻2(𝑖)) (1)
где 𝐻1 и 𝐻2 - это две гистограммы с𝐾 интервалами. Эта функция рас-
стояния привлекательна тем, что может обрабатывать частичные совпаде-
ния, когда области двух гистограмм (сумма по всем столбцам) различны.
Когда гистограммы нормированы (области двух гистограмм равны), пересе-
чение гистограмм эквивалентно нормированному расстоянию𝐿1.
Другой часто используемой функцией является расстояние хи-квадрат.
Оно более трудоемко с точки зрения вычислений, но работает зачастую луч-
ше. Это расстояние определяется как
𝜒2(𝐻1, 𝐻2) =1
2
𝐾∑︁
𝑖=1
(𝐻1(𝑖) −𝐻2(𝑖))2
𝐻1(𝑖) +𝐻2(𝑖) (2)
8
Высшая школа цифровой культуры Университет ИТМО
Основное преимущество расстояния хи-квадрат заключается в том, что
оно рассчитывается на основе относительных значений. Таким образом,
небольшая разница между двумя небольшими значениями будет иметь боль-
шее влияние, чем точно такая же небольшая разница между двумя большими
значениями.
Квантование пространства при построении гистограмм Выбор
функции расстояния для гистограмм - не единственное, что влияет на резуль-
таты. Еще один важный аспект - квантование. Хотя мы имеем дело с цифро-
выми изображениями и, следовательно, все значения уже дискретны, часто
требуется более грубое квантование цветового пространства. Это уменьшит
размер векторов признаков, а также может привести к лучшим конечным ре-
зультатам, если функция расстояния сравнивает только ячейки (например,
как в тех случаях, что мы обсуждали ранее).
Выбор правильной схемы квантования может быть непростым. Если ис-
пользуются функции, сравнивающие расстояния между ячейками, то слиш-
ком мелкозернистое квантование приведет к большим расстояниям даже
между изображениями с похожими, но не совсем одинаковыми цветами.
Слишком грубое квантование приведет к тому, что разные цвета будут от-
несены к одной и той же ячейке, и, таким образом, мы получим небольшое
расстояние между изображениями, которые на самом деле отличаются по
цвету.
Гистограммы в многомерных пространствахДругой сложный аспект
вопроса о квантовании и использовании гистограмм связан с многомерными
пространствами. Цветовые пространства обычно трехмерны: координаты R,
G, B в пространстве RGB, H, S, V - в HSV и т.д. В многомерном пространстве
мы можем строить совместные или маргинальные гистограммы. Совместные
гистограммы данных в N-мерном пространстве являются N-мерными. Мы
просто помещаем точки данных в N-мерные ячейки. Совместные гистограм-
мы часто имеют много пустых ячеек, особенно при мелкозернистом кванто-
вании. Грубое квантование помогает уменьшить общее количество ячеек, и,
таким образом, будет меньше пустых ячеек, но грубое квантование означает
потерю разрешения, кроме того, в одной ячейке окажутся не слишком похо-
жие значения.
Иногда вместо этого в многомерных пространствах используются марги-
нальные гистограммы. Размерность маргинальных гистограмм меньше, чем
N-мерных гистограмм, поскольку одно или несколько измерений в них опу-
щены. На экране вы видите двумерное пространство и пример совместной
гистограммы слева и двух маргинальных гистограмм справа. Совместные и
маргинальные гистограммы очень похожи на совместные и маргинальные
9
Высшая школа цифровой культуры Университет ИТМО
распределения. В маргинальных гистограммах мы получим больше точек
данных в ячейке по сравнению с совместной гистограммой при одинаковых
размерах ячеек для каждого признака.
Квантование пространства при помощи кластеризацииАльтерна-
тивный способ квантования многомерного пространства - это кластеризация
признаков. Количество ячеек определяется количеством кластеров. Этот ме-
тод допускает неоднородное квантование пространства признаков данных.
Центры кластеров обычно определяются с помощью набора доступных при-
меров изображений. Затем, когда необходимо обработать новое ранее не
встречавшееся изображение, его признаки распределяются по ближайшим
ячейкам.
На экране представлено двумерное пространство признаков. Мы можем
квантовать это пространство на две ячейки, используя алгоритм кластериза-
ции с двумя кластерами. Точки X на изображении, показанном на экране, -
это центры двух кластеров.
Квантование с помощьюкластеризации - хорошая альтернатива дляпро-
странств признаков с большой размерностью. Оно не часто используется для
простых цветовых гистограмм, потому что цветовые пространства обычно
имеют только три измерения. Но позже мы рассмотрим по крайней мере
один пример, когда этот метод будет использоваться для других пространств
признаков.
1.6 Сравнение цветов
1.6.1 Гистограммы
Гистограммы с функциями расстояния между ячейками - мощный и ча-
сто используемый инструмент для сравнения цветов двух изображений. Но
он не идеален. Даже с использованием интеллектуальных методов квантова-
ния цветового пространства этот метод все равно не принимает во внимание
сходство между различными цветовыми ячейками. Человек ожидает, что рас-
стояние между гистограммами𝐻1 и 𝐻2 будет меньше, чем расстояние между
гистограммами 𝐻1 и 𝐻3 представленными на экране, потому что, хотя𝐻1
и 𝐻2 не имеют пересекающихся интервалов, общее цветовое распределение
воспринимается человеком как аналогичное, т.к. есть похожие цвета. При ис-
пользовании любой функции расстояния между ячейками расстояние между
𝐻1 и 𝐻2 будет больше, чем расстояние между𝐻1 и 𝐻3, потому что𝐻1 и 𝐻3
имеют одну общую ячейку.
Один из возможных способов решить эту проблему - использовать ку-
мулятивные гистограммы и по-прежнему использовать любую функцию рас-
стояния между ячейками на ваш выбор. Кумулятивная гистограмма - это
10
Высшая школа цифровой культуры Университет ИТМО
гистограмма, в которой каждый интервал подсчитывает значения для этого
интервала плюс значения всех предыдущих интервалов. Кумулятивная ги-
стограмма, соответствующая гистограмме 𝐻1 из нашего предыдущего при-
мера, будет выглядеть следующим образом. Первый интервал будет таким
же как и в исходной гистограмме, второй интервал содержит сумму первого
и второго интервалов исходной гистограммы и так далее. Поскольку второй,
третий и четвертый интервалы в исходной гистограмме пусты, первые че-
тыре интервала совокупной гистограммы будут иметь одинаковое значение.
Затем в пятый интервал нам нужно добавить содержимое предыдущего, т.е.
четвертого интервала, и пятого. И так далее. Цвета на экране сохранены,
поэтому легко проследить создание кумулятивной гистограммы.
Итак, кумулятивная гистограмма, соответствующая исходной гисто-
грамме 𝐻1, выглядит так, как показано на экране. Теперь построим куму-
лятивные гистограммы, соответствующие𝐻2 и 𝐻3. Они окрашены в разные
цвета, чтобы было легче сравнивать. Как вы видите, простое расстояние меж-
ду ячейками, например,𝐿1, теперь дает результат, который лучше соответ-
ствует интуивно ожидаемому результату. Расстояние между кумулятивными
гистограммами 𝐻1 и 𝐻2 меньше, чем между𝐻1 и 𝐻3.
Важно отметить, что этот подход будет работать только в том случае,
если соседние ячейки гистограммы соответствуют подобным цветам.
Можно также также использовать расстояние Вассерштейна (Earth
Mover’s Distance или EMD), чтобы сравнить сходство между ячейками. Оно
также известно как метрика Канторовича – Рубинштейна. Интуитивно по-
нятно, что если каждую гистограмму рассматривать как некоторое коли-
чество земли, распределенной по ячейкам, метрикой является минимальная
«стоимость» превращения одной кучи в другую, которая, как предполагает-
ся, равна количеству земли, которую необходимо переместить, умноженной
на расстояние, на которое она должна быть перемещена. Итак, возвращаясь
к нашему исходному примеру, все три гистограммы,𝐻1, 𝐻2 и 𝐻3 имеют три
единицы «земли» в трех разных ячейках. Чтобы преобразовать𝐻1 в 𝐻2, нам
нужно, чтобы содержимое всех трех ячеек было сдвинуто на шаг вправо. Та-
ким образом, стоимость переезда составляет 3 шага. Чтобы преобразовать𝐻1
в 𝐻3, красная ячейка остается на месте, но две ячейки - светло-зеленую и го-
лубую-нужнопереместитьнабольшеерасстояние:3шагадлясветло-зеленой
и 6 шагов для голубой. Итак, всего 9 шагов. Расстояние Вассертштейна меж-
ду 𝐻1 и 𝐻2 меньше, чем между𝐻1 и 𝐻3, что ближе к восприятию человеком.
Как и кумулятивная гистограмма, расстояние Вассерштейна «работа-
ет» как ожидается только в том случае, если интервалы соседних столбцов
гистограммы соответствуют похожим значениям (похожим цветам в случае
цветовых гистограмм).
Другой вариант - использовать иную функцию расстояния, которая мо-
11
Высшая школа цифровой культуры Университет ИТМО
жет измерять сходство между ячейками. Примером такой функции расстоя-
ния является расстояние в квадратичной форме, показанное на экране. Это
расстояние было предложено в статье Ниблака и др. (1993) для поиска изоб-
ражений на основе цвета. Это обобщенное евклидово расстояние с матрицей
A, которая включает в себя информацию о сходстве между ячейками. Она
содержит коэффициенты подобия для всех ячеек разбитого на части про-
странства.
Пространственное расположение Еще одна проблема с цветовыми ги-
стограммами заключается в том, что они не учитывают пространствен-
ное расположение цветов. Они представляют собой распределение цвета без
какой-либо пространственной информации. Например, цветовые гистограм-
мы показанных на экране трех синтетических изображений совершенно оди-
наковы, т.к. все три изображения имеют одинаковое количество белых и чер-
ных пикселей.
Рассмотрим еще один пример трех разных изображений с одинаковой
цветовой гистограммой, которые, однако, сильно различаются и не будут вос-
приниматься человеком как похожие.
Пространственное расположение цветов На заре компьютерного зре-
ния люди иногда разбивали изображения на определенные или нечеткие бло-
ки и строили цветовые гистограммы для каждого блока независимо. Этот
прием добавляет пространственную информацию к цветовым характеристи-
кам, но он не адаптивен - позиции блоков фиксированы для всех изображе-
ний.
Вот почему одного цвета недостаточно для сравнения изображений: в
сочетании с цветом часто используются текстура и другие признаки.
Гистограммы и квантование - выводыПодводя итог, цветовые гисто-
граммы - это очень простой, но в то же время наглядный метод описания
цветов. Метод цветовых гистограмм был разработан одним из первых, и по-
прежнему является один из наиболее важных методов описания. Несмотря на
то, что в задачах распознавания изображений метод цветовых гистрограмм
был в основном заменен более сложными методами, он может быть достаточ-
но полезным для определенных наборов изображений. Гистограммы до сих
пор широко используются для описания изображения.
Для правильной работы гистограмм важен выбор квантования. С мень-
шим количеством интервалов вероятность того, что две гистограммы будут
иметь ненулевые значения для одних и тех же интервалов, выше, даже когда
точек данных не так много, поэтому метрики поинтервального сравнения
будут работать лучше. Но это также означает более грубое представление
12
Высшая школа цифровой культуры Университет ИТМО
данных, когда разные значения могут быть помещены в один и тот же ин-
тервал.
При большом количестве интервалов мы получаем более детальное пред-
ставление данных, но становится сложнее сопоставить гистограммы - при
небольшом количестве точек данных многие интервалы будут пустыми, а
две гистограммы могут иметь нулевое пересечение, поэтому их будет невоз-
можно сравнить ипользуя поинтервальные метрики сравнения. Расстояние
между двумя изображениями с похожими, но не идентичными цветами будет
большим. Гистограммы с большим количеством интервалов очень разрежен-
ные и, следовательно, чувствительны к шуму.
Квантование также может быть равномерным и независимым от дан-
ных, например, квантование по сетке, когда мы разделяем все пространство
на ячейки. Для многомерного пространства это будет декартовым произве-
дением однородных ячеек в каждом измерении. Это легко реализовать, но
это приведет к очень большому количеству ячееек в случае многомерного
пространства. И поскольку этот разделение не зависит от данных, многие
ячейки могут оказаться пустыми.
Другой способ разбить пространство - это использовать кластеризацию.
Этот подход основан на данных и поэтому разбивает пространство на нерав-
номерные ячейки в соответствии с распределением данных. Это более за-
тратно с точки зрения вычислений: чтобы найти центры ячеек, нам нужно
сгруппировать репрезентативное подмножество данных. Но в то же время
для пространств большой размерности такой метод может привести к умень-
шению количества ячеек при достаточной степени детализации.
Сравнение гистограмм: выводы Для вычисления расстояния между
двумя гистограммами можно использовать разные функции. Большинство
используемых в настоящее время функций расстояния - это функции рас-
стояния между ячейками, которые не учитывают сходство между ячейками.
Наиболее часто используемые метрики - это пересечение гистограмм, которое
вычисляется быстро, и расстояние хи-квадрат, которое вычислить сложнее,
но этот метод зачастую работает лучше, чем простое пересечение гистограм-
мы или𝐿1.
В случае, когда соседние ячейки гистограммы представляют аналогич-
ные значения, для сравнения ячеек можно использовать кумулятивные ги-
стограммы со стандартными функциями расстояния между ячейками или
переключиться на расстояние движителя земли.
Квадратичное расстояние - это более общая функция расстояния, кото-
рую можно использовать для сравнения ячеек. Оно основано на произволь-
ном подобии ячеек, коэффициенты подобия указаны в матрице𝐴.
13
Высшая школа цифровой культуры Университет ИТМО
1.7 Текстуры
Несмотря на то, что признаки цвета несут важную информацию о содер-
жимом изображения, часто этого недостаточно. Еще одна важная для зри-
тельного восприятия человеком характеристика изображения - это текстура.
Она дает нам информацию о структурном расположении поверхностей и объ-
ектов на изображении. Мы не будем обсуждать текстуры так же подробно,
как признаки цвета, но обсудим пару признаков текстуры, которые чаще все-
го использовались ранее.
Что такое текстура? Любой человек способен распознать текстуру; одна-
ко дать формальное определение этому понятию сложно. Описание текстуры
интуитивно определяет такие свойства, как гладкость, грубость и периодич-
ность. Давайте посмотрим на три примера на экране. Белые квадраты на
трех изображениях на экране показывают (слева направо) гладкие, грубые
и периодические текстуры. Описание текстуры дает количественную оценку
воспринимаемойтекстурыизображения.Текстураизображениясодержитин-
формацию о пространственном расположении цвета или интенсивности всего
изображения или определенной его области. Текстуру невозможно опреде-
лить для отдельного пикселя, она зависит от распределения интенсивности в
изображении.
Анализ текстуры играет важную роль для сравнения изображений, до-
полняя цветовые характеристики. Существует множество методов представ-
ления текстуры и сравнения изображений на основе текстуры. Текстурные
признаки можно разделить на статистические, геометрические, модельные и
спектральные.
Статистические признаки описывают распределение интенсивности в
изображении с помощью различных статистических параметров. Признаки
этой категории являются одними из первых текстурных признаков, исполь-
зовавшихся в компьютерном зрении. Один из простейших подходов к опи-
санию текстуры - использование статистических моментов гистограммы ин-
тенсивности изображения или его области. Другие статистические признаки
текстуры включают в себя признаки, основанные на матрицах смежности, а
также гистограммы текстур, построенные на признаках Тамуры.
Геометрические признаки описывают текстуру через элементы тексту-
ры или примитивы. В этот класс признаков входят методы представления
текстуры путем использования диаграмм Вороного и структурных методов.
Последние описывают текстуру через определение примитивов текстуры и
правил размещения этих примитивов относительно друг друга. Структурные
методы не подходят для описания нерегулярных текстур.
Модельные методы текстурного анализа основаны на построении моде-
ли, которую можно использовать не только для описания, но и для создания
14
Высшая школа цифровой культуры Университет ИТМО
текстуры. К этой категории относятся признаки на основе марковских слу-
чайных полей и фракталов.
Спектральные характеристики описывают текстуру в частотной обла-
сти. Они часто основаны на разложении сигнала на взвешенную сумму ба-
зисных функций и использовании весов как элементов вектора признаков.
Среди спектральных подходов особого внимания заслуживают фильтры Га-
бора. Фильтры Габора широко используются во множестве приложений для
обработки изображений. Эти фильтры позволяют аппроксимировать харак-
теристики определенных клеток зрительной коры некоторых млекопитаю-
щих. Фильтры Габора обладают оптимальными свойствами локализации как
в пространственной, так и в частотной области и, таким образом, хорошо
подходят для задач сегментации текстуры.
1.7.1 Фильтры Габора
Фильтры Габора - это линейные фильтры, используемые во многих при-
ложениях обработки изображений для обнаружения границ, анализа тексту-
ры, выделения признаков и т.д. С помощью фильтров Габора можно проана-
лизировать, есть ли в изображении какое-либо конкретное частотное содер-
жание в определенном направлении. Фильтры Габора - это особые классы
полосовых фильтров, то есть они пропускают определенную «полосу» частот
и отклоняют другие. Многие ученые, работающие в области компьютерного
зрения утверждают, что частотные и пространственные представления филь-
тров Габора аналогичны представлениям зрительной системы человека.
В пространственной области двумерный фильтр Габора представляет со-
бой гауссову функцию ядра, модулированную синусоидальной волной опре-
деленной частоты и ориентации. Один из таких двумерных фильтров Габо-
ра показан на экране: двумерное ядро Гаусса, модулированное синусоидой,
ориентированной на 30∘от оси X. Синусоиду иногда называют несущей, а
двумерную функцию гауссовой формы называют огибающей. Фильтрация
изображения с помощью такого фильтра обнаружит наличие краев в опре-
деленном направлении. На практике обычно используется набор фильтров
Габора с разными коэффициентами сжатия (растяжения) и разных направ-
лений. Этот набор фильтров часто называют банком фильтров.
Например, сейчас на экране показан набор фильтров Габора из 40 филь-
тров для 5 коэффициентов сжатия и 8 направлений. Проще говоря, фильтры
Габора обнаруживают градиенты изображения определенной направленно-
сти. Свертка участков изображения с множеством различных частот и на-
правлений позволяет извлечь информацию о локальной текстуре и закодиро-
вать ее в низкоразмерный вектор признаков.
Фильтрысворачиваютсясисходнымизображением,врезультатеполуча-
15
Высшая школа цифровой культуры Университет ИТМО
ется так называемое пространство Габора. Затем можно вычислить значения
энергии отклика для каждого фильтра, и сформировать из значений энергии
вектор признаков текстуры для данного изображения.
1.7.2 Фильры ICA
Хотя фильтры Габора считаются хорошим приближением к структуре
работы определенных клеток зрительной коры головного мозга человека, они
не могут изменяться в зависимости от данных. Одним из примеров фильтров,
который принимает в расчет изначальные данные (появившихся до широко-
го распространения глубокого обучения), являются фильтры ICA, где ICA
означает анализ независимых компонентов. Эти фильтры также можно ис-
пользовать для анализа текстуры. Они построены с использованием незави-
симого компонентного анализа (independent component analysis). Репрезен-
тативный набор изображений используется для «изучения» «независимых
компонентов». В своей простейшей форме ICA - это алгоритм поиска линей-
ного преобразования, минимизирующего статистическую зависимость меж-
ду компонентами входного вектора. Когда ICA применяется к естественным
изображениям, этот метод создает наборы визуальных фильтров, которые
работают как простые клетки первичной зрительной коры. Они простран-
ственно локализованы, ориентированы и избирательны к структуре в раз-
личных пространственных масштабах. Эти фильтры являются примитивами,
которые представляют собой пространственные шаблоны, встречающиеся в
разных сценах. Каждый фрагмент изображения может быть представлен как
комбинация наборов таких примитивов. На экране показаны примеры филь-
тров ICA, извлеченные авторами из фрагментов естественных изображений,
найденных в Интернете.
Фильтры ICA - модель ответаПосле того, как фильтры получены, каж-
дое изображение может быть охарактеризовано с помощью N общих филь-
тров как набор из N ответов. Энергетические отклики изображения𝐼(𝑥, 𝑦)
при выбранным наборе фильтров оцениваются как квадраты свертки изоб-
ражения с каждым фильтром. Операция возведения в квадрат, которая со-
ответствует энергии ответа, необходима для устранения внутренней неодно-
значности в отношении знака сигналов, которые оцениваются с помощью
ICA. Вместо возведения в квадрат можно также использовать абсолютное
значение.
Итак, после фильтрации с помощью N фильтров у нас есть N ответов.
Теперь мы можем выбрать разные дескрипторы (или сигнатуры): исполь-
зовать только среднее значение ответов, среднее значение и дисперсию или
гистограмму. Гистограммы содержат больше информации о распределении,
16
Высшая школа цифровой культуры Университет ИТМО
поэтому это представление и было выбрано авторами.
Текстуры двух изображений теперь можно сравнивать путем сравнения
распределенияответовэтихизображенийнафильтрыICA.Авторыфильтров
ICA предложили использовать расхождение Кульбака-Лейблера для сравне-
нияраспределенийответов.Этоещеодначастоиспользуемаямера,использу-
емая для сравнения распределения вероятностей. Иногда ее также называют
относительной энтропией. Она определяется как:
𝐾𝐿(𝑓1, 𝑓2) =−
∫︁ ∞
−∞
𝑓1(𝑥) log
(︂𝑓1(𝑥)
𝑓2(𝑥)
)︂
d𝑥 (3)
Благодаря вогнутости логарифмической функции эта мера положитель-
на, когда𝑓1 и 𝑓2 различны, и равна нулю, если𝑓1 равно 𝑓2. Но она не сим-
метрична и не удовлетворяет неравенству треугольника. Первый недостаток
можно решить с помощью использования симметричного отображения этой
меры:
𝐾𝐿𝑠(𝑓1, 𝑓2) =𝐾𝐿(𝑓1, 𝑓2) +𝐾𝐿(𝑓2, 𝑓2) (4)
Если в качестве сигнатур изображений используются гистограммы, то
различие между изображениями, представленными гистограммами𝐻1 и 𝐻2,
вычисляется как:
𝐾𝐿𝑠(𝐻1, 𝐻2) =
𝐵∑︁
𝑏=1
𝐻1(𝑏) log
(︂𝐻1(𝑏)
𝐻2(𝑏)
)︂
+
𝐵∑︁
𝑏=1
𝐻2(𝑏) log
(︂𝐻2(𝑏)
𝐻2(𝑏)
)︂
=
𝐵∑︁
𝑏=1
((𝐻1(𝑏) −𝐻2(𝑏)) log
(︂𝐻1(𝑏)
𝐻2(𝑏)
)︂
(5)
Здесь 𝐵 - это общее количество интервалов в гистограммах: обе гисто-
граммы 𝐻1 и 𝐻2 имеют одинаковое количество интервалов.
Но каждое изображение характеризуется не одной гистограммой, а на-
бором из N гистограмм. Каждый ответ можно рассматривать как плотность
независимой переменной, а набор из𝑁 ответов как многомерное распределе-
ние. Расхождение Кульбака-Лейблера между двумя многомерными распреде-
лениями с независимыми компонентами представляет собой сумму расхожде-
ний Кульбака-Лейблера между каждыми двумя компонентами. Таким обра-
зом, для каждого изображения, представленного гистограммами𝑁, несход-
ство между изображениями можно вычислить как:
𝐾𝐿𝐼(𝐼1, 𝐼2) =
𝑁∑︁
𝑖=1
𝐾𝐿𝑠(𝐻1,𝑖, 𝐻2,𝑖) (6)
17
Высшая школа цифровой культуры Университет ИТМО
Итак, для каждого фильтра 𝑖 = 1 . . . 𝑁мы вычисляем расхождение
Кульбака-Лейблера между ответами изображения 𝐼1 и изображения 𝐼2 на
этот фильтр, а затем суммируем все эти различия для каждого фильтра.
Мы рассмотрели несколько примеров глобальных признаков, использу-
емых для анализа для цвета и текстуры. Существует большое количество
разных подходов к описанию цвета и текстуры. Также было предложено
несколько дескрипторов формы. Но в последние годы с развитием глубо-
кого обучения все меньше и меньше подобных признаков используется на
практике.
18
